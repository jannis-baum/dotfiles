PLUGIN_DIR="$CONFIG_DIR/plugins"
SCRIPT_DIR="$CONFIG_DIR/scripts"

# bar appearance
bar=(
    position=top
    height=32
    notch_display_height=33
    color=0xff000000
    # as close to edge as possible
    padding_left=-9999
    padding_right=-9999
    topmost=on
)
sketchybar --bar "${bar[@]}"
sketchybar --load-font "$CONFIG_DIR/media/PoiretOne-With-Lightning.ttf"

# item defaults
default=(
  y_offset=1

  label.padding_left=12
  label.padding_right=12
  label.font=Menlo:Bold:14
  label.color=0xffbbbbbb

  popup.align=right
  popup.height=20
  popup.blur_radius=12
  popup.background.color=0x99000000
  popup.background.corner_radius=8
  #popup.background.border_color=0x33dddddd
  #popup.background.border_width=1
)
sketchybar --default "${default[@]}"

# reused props
label_color_alert="label.color=0xfffc897e"
label_font_symbol="label.font=SF Compact:Thin:14"
label_font_numbers="label.font=Poiret One:Bold:18"

# invisible button that covers all empty space to hide briefly and show vanilla
# menubar (added first to be in background)
sketchybar --add item hide-button right \
           --set hide-button \
               width=9999 \
               click_script="$SCRIPT_DIR/hide-briefly.zsh"

# right items (always visible)
# clock
sketchybar --add item clock right \
           --set clock \
               "$label_font_numbers" \
               update_freq=1 \
               script="$PLUGIN_DIR/clock.zsh" \
               click_script="$SCRIPT_DIR/show-control-center.zsh" \
           --subscribe clock mouse.entered mouse.exited \
sketchybar --add item clock-date popup.clock \
           --set clock-date \
               update_freq=60 \
               script='sketchybar --set $NAME label="􀉉 $(date "+%a, %b %d" | xargs)"'
sketchybar --add item clock-seconds popup.clock \
           --set clock-seconds \
               update_freq=1 \
               script='sketchybar --set $NAME label="􀐫 $(date +%H:%M:%S | xargs)"'

# battery
sketchybar --add item battery right \
           --set battery \
               "$label_font_numbers" \
               update_freq=10 \
               script="$PLUGIN_DIR/battery.zsh" \
           --subscribe battery mouse.entered mouse.exited power_source_change
sketchybar --add item battery-percentage popup.battery \
           --set battery-percentage \
               update_freq=10 \
               script="$PLUGIN_DIR/battery-percent.zsh" \
           --subscribe battery-percentage power_source_change

# right items (visible if important information)
sketchybar --add item volume right \
           --set volume \
               "$label_font_symbol" \
               script="$PLUGIN_DIR/volume.zsh" \
               click_script="$SCRIPT_DIR/mute.zsh" \
           --subscribe volume volume_change
sketchybar --add item remote right \
           --set remote \
               update_freq=1 \
               "$label_font_symbol" \
               "$label_color_alert" \
               script="$PLUGIN_DIR/remote.zsh" \
               click_script="$SCRIPT_DIR/disconnect-remote.zsh"
sketchybar --add item cpu_busy right \
           --set cpu_busy \
               "$label_font_symbol" \
               "$label_color_alert" \
               update_freq=5 \
               script="$PLUGIN_DIR/cpu-busy.zsh" \
               label="􀫥" \
               drawing=off \
           --subscribe cpu_busy mouse.entered mouse.exited

# left app indicator if no tabs
sketchybar --add event tabs_updated
sketchybar --add item front_app left \
           --set front_app \
                script="$PLUGIN_DIR/front_app.zsh" \
           --subscribe front_app front_app_switched tabs_updated

# update all items
sketchybar --update

# clear timer data
rm ~/.local/state/sketchybar/timers/*
# init sketchytabs
$SCRIPT_DIR/init-sketchytabs.zsh
